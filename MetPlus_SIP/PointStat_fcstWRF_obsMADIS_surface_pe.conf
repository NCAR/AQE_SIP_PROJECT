[config]

# For additional information, please see the METplus Users Guide.
# https://metplus.readthedocs.io/en/latest/Users_Guide

###
# Processes to run
# https://metplus.readthedocs.io/en/latest/Users_Guide/systemconfiguration.html#process-list
###

# PROCESS_LIST = DataIngest, PointStat, StatAnalysis, UserScript(reformat_CNT), UserScript(plot_CNT_stats), UserScript(plot_wind_rose), UserScript(plot_bias_maps)
PROCESS_LIST = UserScript(plot_wind_rose), UserScript(plot_bias_maps)

###
# Time Info
# LOOP_BY options are INIT, VALID, RETRO, and REALTIME
# If set to INIT or RETRO:
#   INIT_TIME_FMT, INIT_BEG, INIT_END, and INIT_INCREMENT must also be set
# If set to VALID or REALTIME:
#   VALID_TIME_FMT, VALID_BEG, VALID_END, and VALID_INCREMENT must also be set
# LEAD_SEQ is the list of forecast leads to process
# https://metplus.readthedocs.io/en/latest/Users_Guide/systemconfiguration.html#timing-control
###

LOOP_BY = VALID
VALID_TIME_FMT = %Y%m%d%H
VALID_BEG = 2022072000
VALID_END = 2022072023
VALID_INCREMENT = 1H

LEAD_SEQ = 0

WRF_DOMAIN = d03

# Masking Regions
POINT_STAT_MASK_GRID = FULL
POINT_STAT_MASK_POLY = {OUTPUT_BASE}/masks/Front_Range.nc


###
# DataIngest File I/O
# https://metplus.readthedocs.io/en/latest/Users_Guide/systemconfiguration.html#directory-and-filename-template-info
###

DATA_INGEST_SKIP_IF_OUTPUT_EXISTS = False

DATA_INGEST_1_INPUT_TEMPLATE = https://madis-data.ncep.noaa.gov/madisPublic/data/archive/{valid?fmt=%Y/%m/%d}/point/metar/netcdf/{valid?fmt=%Y%m%d_%H%M}.gz
DATA_INGEST_1_OUTPUT_TEMPLATE = {OUTPUT_BASE}/data_ingest/MADIS/metar/{valid?fmt=%Y%m%d_%H%M}.nc
#DATA_INGEST_1_SKIP_IF_OUTPUT_EXISTS = False
DATA_INGEST_1_AUTO_DECOMPRESS = True
DATA_INGEST_1_USERNAME = anonymous
DATA_INGEST_1_PASSWORD = anonymous


###
# PointStat File I/O
# https://metplus.readthedocs.io/en/latest/Users_Guide/systemconfiguration.html#directory-and-filename-template-info
###

FCST_POINT_STAT_INPUT_DIR = {INPUT_BASE}/WRF
FCST_POINT_STAT_INPUT_TEMPLATE = PYTHON_NUMPY

OBS_POINT_STAT_INPUT_DIR =
OBS_POINT_STAT_INPUT_TEMPLATE = PYTHON_NUMPY= {CONF_DIR}/python_scripts/convert_madis_sfc_allvars.py {DATA_INGEST_1_OUTPUT_TEMPLATE}
#OBS_POINT_STAT_INPUT_TEMPLATE = PYTHON_NUMPY= {CONF_DIR}/python_scripts/convert_madis_sfc_allvars.py {OUTPUT_BASE}/data_ingest/MADIS/metar/{valid?fmt=%Y%m%d_%H%M}.nc

POINT_STAT_OUTPUT_DIR = {OUTPUT_BASE}/PointStat/surface
POINT_STAT_OUTPUT_TEMPLATE = {valid?fmt=%Y%m%d}


###
# PointStat Field Info
# https://metplus.readthedocs.io/en/latest/Users_Guide/systemconfiguration.html#field-info
###

POINT_STAT_ONCE_PER_FIELD = False

FCST_POINT_STAT_VAR1_NAME = {CONF_DIR}/python_scripts/convert_wrf_sfc.py {FCST_POINT_STAT_INPUT_DIR}/wrfout_{WRF_DOMAIN}_{valid?fmt=%Y-%m-%d}_{valid?fmt=%H:%M:%S} T2
FCST_POINT_STAT_VAR1_OPTIONS = convert(x) = K_to_F(x); set_attr_units = "F";
FCST_POINT_STAT_VAR1_THRESH = <=32, >32
OBS_POINT_STAT_VAR1_NAME = temperature
OBS_POINT_STAT_VAR1_LEVELS = Z2
OBS_POINT_STAT_VAR1_THRESH = <=32, >32
OBS_POINT_STAT_VAR1_OPTIONS = convert(x) = K_to_F(x); set_attr_units = "F";

FCST_POINT_STAT_VAR2_NAME = {CONF_DIR}/python_scripts/convert_wrf_sfc.py {FCST_POINT_STAT_INPUT_DIR}/wrfout_{WRF_DOMAIN}_{valid?fmt=%Y-%m-%d}_{valid?fmt=%H:%M:%S} DPT
FCST_POINT_STAT_VAR2_OPTIONS = convert(x) = K_to_F(x); set_attr_units = "F";
OBS_POINT_STAT_VAR2_NAME = dewpoint
OBS_POINT_STAT_VAR2_LEVELS = Z2
OBS_POINT_STAT_VAR2_OPTIONS = convert(x) = K_to_F(x); set_attr_units = "F";

FCST_POINT_STAT_VAR3_NAME = {CONF_DIR}/python_scripts/convert_wrf_sfc.py {FCST_POINT_STAT_INPUT_DIR}/wrfout_{WRF_DOMAIN}_{valid?fmt=%Y-%m-%d}_{valid?fmt=%H:%M:%S} U10
FCST_POINT_STAT_VAR3_OPTIONS = set_attr_name = "UGRD"; is_u_wind = TRUE;
OBS_POINT_STAT_VAR3_NAME = U
OBS_POINT_STAT_VAR3_LEVELS = Z10
OBS_POINT_STAT_VAR3_OPTIONS = set_attr_name = "UGRD"; set_attr_units = "m_s-1"; is_u_wind = TRUE;

FCST_POINT_STAT_VAR4_NAME = {CONF_DIR}/python_scripts/convert_wrf_sfc.py {FCST_POINT_STAT_INPUT_DIR}/wrfout_{WRF_DOMAIN}_{valid?fmt=%Y-%m-%d}_{valid?fmt=%H:%M:%S} V10
FCST_POINT_STAT_VAR4_OPTIONS = set_attr_name = "VGRD"; is_v_wind = TRUE;
OBS_POINT_STAT_VAR4_NAME = V
OBS_POINT_STAT_VAR4_LEVELS = Z10
OBS_POINT_STAT_VAR4_OPTIONS = set_attr_name = "VGRD"; set_attr_units = "m_s-1"; is_v_wind = TRUE;

FCST_POINT_STAT_VAR5_NAME = {CONF_DIR}/python_scripts/convert_wrf_sfc.py {FCST_POINT_STAT_INPUT_DIR}/wrfout_{WRF_DOMAIN}_{valid?fmt=%Y-%m-%d}_{valid?fmt=%H:%M:%S} RH
OBS_POINT_STAT_VAR5_NAME = RH
OBS_POINT_STAT_VAR5_LEVELS = Z2
OBS_POINT_STAT_VAR5_OPTIONS = set_attr_units = "%";

FCST_POINT_STAT_VAR6_NAME = {CONF_DIR}/python_scripts/convert_wrf_sfc.py {FCST_POINT_STAT_INPUT_DIR}/wrfout_{WRF_DOMAIN}_{valid?fmt=%Y-%m-%d}_{valid?fmt=%H:%M:%S} PSFC
OBS_POINT_STAT_VAR6_NAME = PSFC
OBS_POINT_STAT_VAR6_LEVELS = L0
OBS_POINT_STAT_VAR6_OPTIONS = set_attr_units = "Pa";


###
# PointStat Settings
# https://metplus.readthedocs.io/en/latest/Users_Guide/wrappers.html#pointstat
###

POINT_STAT_CONFIG_FILE ={PARM_BASE}/met_config/PointStatConfig_wrapped

POINT_STAT_INTERP_TYPE_METHOD = BILIN
POINT_STAT_INTERP_TYPE_WIDTH = 2

POINT_STAT_OUTPUT_FLAG_CTC = STAT
POINT_STAT_OUTPUT_FLAG_CTS = STAT
POINT_STAT_OUTPUT_FLAG_CNT = STAT
POINT_STAT_OUTPUT_FLAG_SL1L2 = STAT
POINT_STAT_OUTPUT_FLAG_VL1L2 = STAT
POINT_STAT_OUTPUT_FLAG_VCNT = STAT
POINT_STAT_OUTPUT_FLAG_MPR = BOTH

MODEL = WRF

#POINT_STAT_DESC = {valid?fmt=%H}
OBTYPE = MADIS

POINT_STAT_MESSAGE_TYPE = ADPSFC

OBS_POINT_STAT_WINDOW_BEGIN = -1800
OBS_POINT_STAT_WINDOW_END = 1800

###
# StatAnalysis File I/O
# https://metplus.readthedocs.io/en/latest/Users_Guide/systemconfiguration.html#directory-and-filename-template-info
###

MODEL1_STAT_ANALYSIS_LOOKIN_DIR = {POINT_STAT_OUTPUT_DIR}/*

STAT_ANALYSIS_OUTPUT_DIR = {OUTPUT_BASE}/StatAnalysis/surface

MODEL1_STAT_ANALYSIS_OUT_STAT_TEMPLATE = {model?fmt=%s}_MADIS_surface_{fcst_valid_beg?fmt=%Y%m%d%H}_{fcst_valid_end?fmt=%Y%m%d%H}
MODEL1_STAT_ANALYSIS_DUMP_ROW_TEMPLATE = {model?fmt=%s}_MADIS_surface_{fcst_valid_beg?fmt=%Y%m%d%H}_{fcst_valid_end?fmt=%Y%m%d%H}


###
# StatAnalysis Settings
# https://metplus.readthedocs.io/en/latest/Users_Guide/wrappers.html#statanalysis
###

STAT_ANALYSIS_CONFIG_FILE = {PARM_BASE}/met_config/STATAnalysisConfig_wrapped

MODEL1 = WRF
MODEL1_OBTYPE = ADPSFC

# Stat-Analysis Jobs
STAT_ANALYSIS_JOB1 = -job aggregate_stat -line_type SL1L2 -out_line_type CNT -by FCST_VAR,FCST_VALID_HOUR,VX_MASK -out_stat [out_stat_file]_all_stations_hourly_CNT.stat

STAT_ANALYSIS_JOB2 =  -job aggregate_stat -line_type MPR -out_line_type CNT -by FCST_VAR,OBS_SID -set_hdr VX_MASK OBS_SID -out_stat [out_stat_file]_separate_stations_CNT.stat

STAT_ANALYSIS_JOB3 = -job filter -fcst_var UGRD,VGRD -vx_mask Front_Range -line_type MPR -dump_row [dump_row_file]_wind_Front_Range_MPR.stat

STAT_ANALYSIS_JOB4 = -job filter -fcst_var UGRD,VGRD -vx_mask FULL -line_type MPR -dump_row [dump_row_file]_wind_FULL_MPR.stat

STAT_ANALYSIS_JOB5 = -job filter -line_type MPR -dump_row [dump_row_file]_AllVars_FULL_MPR.stat

STAT_ANALYSIS_JOB6 = -job aggregate_stat -line_type VL1L2 -out_line_type VCNT -by FCST_VAR,FCST_VALID_HOUR,VX_MASK -out_stat [out_stat_file]_all_stations_hourly_VCNT.stat

STAT_ANALYSIS_JOB7 = -job aggregate_stat -line_type MPR -out_line_type VCNT -by FCST_VAR,OBS_SID -set_hdr VX_MASK OBS_SID -out_stat [out_stat_file]_separate_stations_VCNT.stat


MODEL_LIST = {MODEL1}
GROUP_LIST_ITEMS = MODEL_LIST
LOOP_LIST_ITEMS = 


[reformat_CNT]
###
# UserScript Settings to reformat the CNT linetype
# https://metplus.readthedocs.io/en/latest/Users_Guide/wrappers.html#userscript
###

USER_SCRIPT_RUNTIME_FREQ = RUN_ONCE
USER_SCRIPT_COMMAND = {CONF_DIR}/python_scripts/reformat_linetype.py {CONF_DIR}/yaml_configurations/reformat_CNT.yaml


[plot_CNT_stats]
###
# UserScript Settings to create the plots
# https://metplus.readthedocs.io/en/latest/Users_Guide/wrappers.html#userscript
###

USER_SCRIPT_RUNTIME_FREQ = RUN_ONCE
USER_SCRIPT_COMMAND = {CONF_DIR}/python_scripts/plot_line_stats.py


[plot_wind_rose]
###
# UserScript Settings to create the Wind Rose Plots
# https://metplus.readthedocs.io/en/latest/Users_Guide/wrappers.html#userscript
###

USER_SCRIPT_RUNTIME_FREQ = RUN_ONCE
USER_SCRIPT_COMMAND = {CONF_DIR}/python_scripts/plot_wind_rose.py


[plot_bias_maps]
###
# UserScript Settings to create the Bias Map Plots
# https://metplus.readthedocs.io/en/latest/Users_Guide/wrappers.html#userscript
###

USER_SCRIPT_CUSTOM_LOOP_LIST = T2, RH, DPT, PSFC

USER_SCRIPT_RUNTIME_FREQ = RUN_ONCE
USER_SCRIPT_COMMAND = {CONF_DIR}/python_scripts/plot_bias_stations.py {custom?fmt=%s}


[user_env_vars]
# This section contains some needed variables for the reformatting and plotting

# Paths to METdataio, METcalcpy, and METplotpy as needed for the use case
METDATAIO_BASE = {CONF_DIR}/METdataio
METCALCPY_BASE = {CONF_DIR}/METcalcpy
METPLOTPY_BASE = {CONF_DIR}/METplotpy
PYTHONPATH = {METDATAIO_BASE}:{METDATAIO_BASE}/METdbLoad:{METDATAIO_BASE}/METdbLoad/ush:{METDATAIO_BASE}/METreformat:{METCALCPY_BASE}:{METCALCPY_BASE}/metcalcpy:{METPLOTPY_BASE}:{METPLOTPY_BASE}/metplotpy/plots


###
# Settings for the reformatting of the CNT linetype, to later be used for plotting
### 
# Input directory where the .stat files you need to reformat are located 
REFORMAT_CNT_INPUT_DIR = {STAT_ANALYSIS_OUTPUT_DIR}

# Output directory to store the reformatted data
REFORMAT_CNT_OUTPUT_DIR = {OUTPUT_BASE}/reformatted/surface

# Name of the output file containing reformatted data
REFORMAT_CNT_OUTPUT_FILENAME = reformat_CNT.data

# Line type to reformat
# Currently support FHO, CTC, CTS, CNT, SL1L2, VL1L2, PCT, MCTC, VCNT, ECNT, RHIST, TCDiag, and MPR line types
REFORMAT_CNT_LINETYPE = CNT


###
# Settings for creating the plots of ME, MAE, and RMSE for the CNT Data
###
# Directory where the YAML configurations for plotting are located
PLOTTING_CNT_YAML_CONFIG_DIR = {CONF_DIR}/yaml_configurations

# YAML Configuration file list
PLOTTING_CNT_YAML_CONFIG_FILE_LIST = custom_line_MAE_env.yaml, custom_line_ME_env.yaml, custom_line_RMSE_env.yaml

# A list of variables to be plotted
PLOTTING_CNT_FCST_VAR_LIST = T2, RH, DPT, PSFC

# A list of the long names to be used in the plotting titles
# This should be in the same order as PLOTTING_INPUT_FCST_VAR_LIST
PLOTTING_CNT_FCST_VAR_NAME_LIST = 2m Temperature, 2m Relative Humidity, 2m Dew Point, Surface Pressure

# A list of variable units to be used in the plotting axis labels
# This should be in the same order as PLOTTING_INPUT_FCST_VAR_LIST
PLOTTING_CNT_FCST_VAR_UNITS_LIST = F, %, F, Pa

# A list of the long names to be used in the plotting titles
PLOTTING_CNT_VX_MASK_LIST = FULL, Front_Range

#Input for plotting (this is the Reformatted data above 
PLOTTING_CNT_STAT_INPUT = {REFORMAT_CNT_OUTPUT_DIR}/{REFORMAT_CNT_OUTPUT_FILENAME}

# Output directory for plots
PLOTTING_CNT_OUTPUT_DIR = {OUTPUT_BASE}/plots/surface

# Log file for the plotting
PLOTTING_CNT_LOG_FILENAME = {LOG_DIR}/plotting_cnt.log


###
# Settings for creating the Wind Rose plots
###
# Directory where the YAML configurations for plotting are located
WIND_ROSE_YAML_CONFIG_DIR = {CONF_DIR}/yaml_configurations

# YAML Configuration file list
WIND_ROSE_YAML_CONFIG_FILE_LIST = wind_rose_fcst.yaml, wind_rose_obs.yaml, wind_rose_diff.yaml

# Directory where input files are located
WIND_ROSE_STAT_INPUT_DIR = {STAT_ANALYSIS_OUTPUT_DIR}

# Input files with U and V to use for plotting
WIND_ROSE_STAT_INPUT_FILES = WRF_MADIS_surface_2022072000_2022072023_wind_Front_Range_MPR.stat, WRF_MADIS_surface_2022072000_2022072023_wind_FULL_MPR.stat

# Labels which will be added to the output file names
# Should have the same number of elements as the input files above
WIND_ROSE_OUTPUT_LABELS = Front_Range, FULL

# Output directory for plots
WIND_ROSE_OUTPUT_DIR = {OUTPUT_BASE}/plots/surface

# Log file for the plotting
WIND_ROSE_LOG_FILENAME = {LOG_DIR}/plotting.log


###
# Settings for creating the Bias Map Plots
###
# CNT statistics File
MAP_CNT_FILE = {STAT_ANALYSIS_OUTPUT_DIR}/WRF_MADIS_surface_2022072000_2022072023_separate_stations_CNT.stat

# Combine MPR File
MAP_MPR_FILE = {STAT_ANALYSIS_OUTPUT_DIR}/WRF_MADIS_surface_2022072000_2022072023_AllVars_FULL_MPR.stat

# Output directory for plots
MAP_OUTPUT_DIR = {OUTPUT_BASE}/plots/surface_maps
